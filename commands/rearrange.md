---
description: "현재 브랜치의 커밋들을 리뷰하기 쉽게 재정렬합니다"
---

# 커밋 재정렬 명령어

이 명령은 현재 브랜치에서 원본 브랜치 이후에 추가된 커밋들을 분석하고, 리뷰어가 이해하기 쉽도록 재정렬, 분할, 병합합니다.

## 사용법

```
/rearrange [원본브랜치]
```

- `원본브랜치`: 비교 기준이 될 브랜치 (기본값: `main`)

## 실행 절차

### 1단계: 커밋 및 변경사항 분석

원본 브랜치 이후 추가된 커밋들과 각 커밋의 변경 내용을 확인합니다:

```bash
BASE_BRANCH="${1:-main}"
git log --oneline ${BASE_BRANCH}..HEAD
git log --oneline --name-status ${BASE_BRANCH}..HEAD
git log -p ${BASE_BRANCH}..HEAD
```

### 2단계: 프로젝트 커밋 스타일 파악

최근 커밋들을 분석하여 프로젝트에서 사용하는 커밋 메시지 형식을 파악합니다:

```bash
git log --oneline -20
```

### 3단계: 커밋 분석 및 작업 계획 수립

각 커밋의 변경 내용을 분석하여 다음 사항을 파악합니다:

#### 분석 항목

1. **코드베이스/스코프별 그룹화**

   - 같은 디렉토리나 모듈을 수정한 커밋들을 식별

2. **변경 성격별 분리**

   - **실제 동작 변경**: 새 기능, 버그 수정, API 변경 등
   - **코드 개선**: 리팩토링, 코드 정리, 스타일 변경 등

3. **분할이 필요한 커밋 식별**

   - 한 커밋에 여러 성격의 변경이 섞여 있는 경우
   - 같은 파일 내에서도 다른 성격의 변경이 섞여 있다면, 파일 내 특정 부분(hunk)만 선택적으로 스테이징하여 분리

4. **병합이 필요한 커밋 식별**

   - 같은 분류의 작은 변경이 여러 커밋에 흩어져 있는 경우

5. **의존성 고려**
   - 다른 커밋에 의존하는 변경은 의존 순서대로 배치

#### 작업 유형

- **reorder**: 커밋 순서 변경
- **split**: 하나의 커밋을 여러 커밋으로 분리
- **squash**: 여러 커밋을 하나로 합침
- **edit**: 커밋 메시지 수정

### 4단계: 재정렬 계획 표시

분석 결과를 테이블 형태로 사용자에게 보여줍니다:

```markdown
## 커밋 재정렬 계획

### 현재 커밋 목록

| 순서 | 커밋 해시 | 커밋 메시지 |
| ---- | --------- | ----------- |
| 1    | abc1234   | ...         |
| 2    | def5678   | ...         |

### 계획된 작업

| 작업   | 대상 커밋        | 설명                      |
| ------ | ---------------- | ------------------------- |
| split  | abc1234          | 기능 추가와 리팩토링 분리 |
| squash | def5678, ghi9012 | 같은 모듈 수정 병합       |

### 결과 커밋 구조 (예상)

| 순서 | 분류     | 커밋 메시지 | 원본             |
| ---- | -------- | ----------- | ---------------- |
| 1    | 기능     | ...         | abc1234에서 분할 |
| 2    | 리팩토링 | ...         | abc1234에서 분할 |

### 변경 요약

- 원본 커밋: N개 → 결과 커밋: M개
- 분할: X건, 병합: Y건, 순서 변경: Z건
```

### 5단계: 사용자 확인

`ask_followup_question` 도구를 사용하여 사용자에게 진행 여부를 확인합니다:

- "위 계획대로 커밋을 재정렬하시겠습니까?"
- 옵션: "예, 진행합니다", "아니오, 취소합니다", "계획을 수정하고 싶습니다"

### 6단계: Rebase 실행

사용자가 승인하면 interactive rebase를 통해 계획된 작업을 수행합니다.

### 7단계: 결과 확인

```bash
git log --oneline ${BASE_BRANCH}..HEAD
git diff ${BASE_BRANCH}  # 변경 내용이 동일한지 확인
```

## 주의사항

1. ⚠️ 이미 푸시된 브랜치에서는 force push가 필요합니다.
2. 작업 전 현재 브랜치를 백업하는 것을 권장합니다:
   ```bash
   git branch backup-$(git branch --show-current)
   ```
